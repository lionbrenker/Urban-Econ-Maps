<!DOCTYPE html>
<html>
<head>
    <title>Urban Econ Maps</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- MapLibre GL JS CSS -->
    <link href='https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css' rel='stylesheet' />
    <!-- MapLibre GL JS -->
    <script src='https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js'></script>
    
    <!-- Our New Styles -->
    <style>
        <style>
        body { margin: 0; padding: 0; font-family: sans-serif; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #panel {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            width: 250px;
        }
    </style>
</head>
<body>

    <!-- The map container, which will fill the whole page -->
    <div id="map"></div>

    <!-- The HTML for our new floating control panel -->
    <div id="panel">
        <h2>Frankfurt Data</h2>
        <div class="layer-control">
            <h4>Select Data Layer:</h4>
            <input type="radio" id="housing" name="layer" value="housing_price" checked>
            <label for="housing">Housing Prices (€/m²)</label><br>
            <input type="radio" id="population" name="layer" value="population_density">
            <label for="population">Population Density</label><br>
        </div>
    </div>

    <script>
        // --- 1. INITIALIZE THE MAP ---
        const map = new maplibregl.Map({
            container: 'map', // The ID of our map div
            style: `https://api.maptiler.com/maps/streets/style.json?key=8UPX2x4HfWayBX8z6OFn`, // The map style URL
            center: [8.6821, 50.1109], // Frankfurt's coordinates [longitude, latitude]
            zoom: 15 // Start zoomed in enough to see buildings
        });
        
        let selectedBuildingId = null;
        let selectedRoadId = null;
        
        // --- 2. ADD INTERACTIVITY ---
        map.on('load', () => {
            // The map's style has fully loaded. Now we can add our interactivity.
        
            // Add a new, empty data source for our selected building highlight
            map.addSource('highlight-building', { 'type': 'geojson', 'data': { 'type': 'FeatureCollection', 'features': [] } });
            // Add a new layer to display the highlight
            map.addLayer({
                'id': 'highlight-building-layer',
                'type': 'fill',
                'source': 'highlight-building',
                'paint': { 'fill-color': '#f08', 'fill-opacity': 0.6 }
            });
        
            // Add a new, empty data source for our selected road highlight
            map.addSource('highlight-road', { 'type': 'geojson', 'data': { 'type': 'FeatureCollection', 'features': [] } });
            // Add a new layer to display the highlight
            map.addLayer({
                'id': 'highlight-road-layer',
                'type': 'line',
                'source': 'highlight-road',
                'paint': { 'line-color': '#33f', 'line-width': 4 }
            });
        
        
            // Listen for a click event on the map
            map.on('click', (e) => {
                // Use queryRenderedFeatures to check what was clicked
                const features = map.queryRenderedFeatures(e.point, {
                    layers: ['building', 'road_major', 'road_minor', 'road_street'] // The layer IDs for buildings and roads
                });
        
                // If nothing was clicked, do nothing
                if (!features.length) {
                    return;
                }
        
                const clickedFeature = features[0];
                const layerId = clickedFeature.layer.id;
        
                // Logic for highlighting a building
                if (layerId === 'building') {
                    map.getSource('highlight-building').setData(clickedFeature.geometry);
                    map.getSource('highlight-road').setData({ 'type': 'FeatureCollection', 'features': [] }); // Clear road highlight
                }
        
                // Logic for highlighting a road
                if (layerId.startsWith('road')) {
                    map.getSource('highlight-road').setData(clickedFeature.geometry);
                    map.getSource('highlight-building').setData({ 'type': 'FeatureCollection', 'features': [] }); // Clear building highlight
                }
            });
        });

    </script>

</body>
</html>
